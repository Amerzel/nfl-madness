<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 NFL Playoff Madness</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            margin-bottom: 5px;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            color: #888;
            margin-bottom: 8px;
        }

        .last-updated {
            color: #666;
            font-size: 0.8rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .btn-primary {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
            color: #4CAF50;
        }

        .btn-warning {
            background: rgba(255, 152, 0, 0.3);
            border-color: #FF9800;
            color: #FF9800;
        }

        .simulation-banner {
            display: none;
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid #FF9800;
            border-radius: 8px;
            padding: 10px 20px;
            margin: 15px auto;
            max-width: 600px;
            text-align: center;
            color: #FF9800;
        }

        .simulation-banner.active {
            display: block;
        }

        /* Main Layout */
        .main-content {
            max-width: 1600px;
            margin: 0 auto;
        }

        section {
            margin-bottom: 30px;
        }

        h2 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        /* Bracket Styles */
        .bracket-container {
            overflow-x: auto;
            padding: 10px 0;
        }

        .bracket {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            min-width: 1100px;
            margin: 0 auto;
        }

        .conference {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .round {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .round-label {
            text-align: center;
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .matchup {
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            overflow: hidden;
            min-width: 120px;
        }

        .team {
            padding: 8px 10px;
            display: flex;
            align-items: center;
            gap: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .team:last-child {
            border-bottom: none;
        }

        .team.winner {
            background: rgba(76, 175, 80, 0.3);
            font-weight: bold;
        }

        .team.loser {
            opacity: 0.5;
        }

        .team.clickable {
            cursor: pointer;
        }

        .team.clickable:hover {
            background: rgba(255, 152, 0, 0.3);
        }

        .team.simulated {
            background: rgba(255, 152, 0, 0.4);
            border-left: 3px solid #FF9800;
        }

        .seed {
            background: rgba(255,255,255,0.2);
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 0.7rem;
            min-width: 18px;
            text-align: center;
        }

        .score {
            margin-left: auto;
            font-weight: bold;
            color: #888;
            font-size: 0.75rem;
        }

        .team.winner .score {
            color: #4CAF50;
        }

        .super-bowl {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            min-width: 150px;
        }

        .super-bowl h3 {
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .super-bowl .matchup {
            background: rgba(0,0,0,0.2);
        }

        .super-bowl .team {
            color: #000;
        }

        .super-bowl .team.winner {
            background: rgba(0,0,0,0.3);
        }

        .super-bowl .team.clickable:hover {
            background: rgba(0,0,0,0.4);
        }

        /* Two Column Layout for Standings and Info */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }

        /* Standings Styles */
        .standings-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .standings-table th,
        .standings-table td {
            padding: 12px 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .standings-table th {
            background: rgba(255,255,255,0.1);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.7rem;
            color: #888;
        }

        .standings-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .standings-table .rank {
            font-weight: bold;
            color: #4CAF50;
            width: 40px;
        }

        .standings-table .rank-1 { color: #FFD700; }
        .standings-table .rank-2 { color: #C0C0C0; }
        .standings-table .rank-3 { color: #CD7F32; }

        .standings-table .points {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .standings-table .sim-points {
            color: #FF9800;
            font-size: 0.8rem;
            margin-left: 5px;
        }

        .standings-table .tiebreaker {
            color: #888;
            font-size: 0.85rem;
        }

        .standings-table .change {
            font-size: 0.75rem;
            margin-left: 5px;
        }

        .standings-table .change.up { color: #4CAF50; }
        .standings-table .change.down { color: #f44336; }

        /* Info Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-box {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
        }

        .info-box h3 {
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: #888;
            text-transform: uppercase;
        }

        .scoring-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.85rem;
        }

        .scoring-grid span:nth-child(even) {
            text-align: right;
            color: #4CAF50;
        }

        .payout-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.85rem;
        }

        .payout-row:last-child {
            border-bottom: none;
        }

        .payout-row span:last-child {
            color: #FFD700;
        }

        /* Picks Grid */
        .picks-container {
            overflow-x: auto;
        }

        .picks-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.8rem;
        }

        .picks-table th,
        .picks-table td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .picks-table th {
            background: rgba(255,255,255,0.1);
            font-weight: 600;
            position: sticky;
            top: 0;
            font-size: 0.75rem;
        }

        .picks-table .round-header {
            background: rgba(76, 175, 80, 0.15);
            font-weight: 600;
        }

        .picks-table .game-col {
            text-align: left;
            font-weight: 500;
            white-space: nowrap;
            padding-left: 10px;
        }

        .picks-table .correct {
            background: rgba(76, 175, 80, 0.25);
            color: #4CAF50;
            font-weight: bold;
        }

        .picks-table .incorrect {
            background: rgba(244, 67, 54, 0.15);
            color: #e57373;
            text-decoration: line-through;
        }

        .picks-table .pending {
            color: #888;
        }

        .picks-table .simulated-correct {
            background: rgba(255, 152, 0, 0.25);
            color: #FFB74D;
            font-weight: bold;
        }

        .picks-table .simulated-incorrect {
            background: rgba(255, 152, 0, 0.1);
            color: #999;
            text-decoration: line-through;
        }

        .picks-table .actual-result {
            background: rgba(255, 215, 0, 0.15);
            font-weight: bold;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .legend-box.correct { background: rgba(76, 175, 80, 0.3); }
        .legend-box.incorrect { background: rgba(244, 67, 54, 0.2); }
        .legend-box.pending { background: rgba(255, 255, 255, 0.1); }
        .legend-box.simulated { background: rgba(255, 152, 0, 0.3); }

        .click-hint {
            text-align: center;
            color: #888;
            font-size: 0.8rem;
            margin-bottom: 10px;
            font-style: italic;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }

        .section-header:hover {
            opacity: 0.8;
        }

        .collapse-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #888;
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .collapse-btn:hover {
            background: rgba(255,255,255,0.2);
            color: #fff;
        }

        .collapsible {
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 1000px;
            opacity: 1;
        }

        .collapsible.collapsed {
            max-height: 0;
            opacity: 0;
        }

        /* Scenarios */
        .scenarios-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .scenarios-container {
                grid-template-columns: 1fr;
            }
        }

        .scenario {
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            padding: 15px;
        }

        .scenario-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
        }

        .payout-value {
            color: #FFD700;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.6rem; }
            .bracket { min-width: 900px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>2026 NFL Playoff Madness</h1>
        <p class="subtitle">Entry Fee: $20 | Total Pot: $260 | 13 Players</p>
        <p class="last-updated" id="last-updated">Loading scores...</p>
    </div>

    <div class="controls">
        <button class="btn btn-primary" onclick="fetchESPNData()">Refresh Scores</button>
        <button class="btn btn-warning" onclick="clearSimulation()" id="clear-sim-btn" style="display:none;">Clear Simulation</button>
    </div>

    <div class="simulation-banner" id="sim-banner">
        <strong>Simulation Mode:</strong> Click teams to preview different outcomes. <span id="sim-count">0</span> game(s) simulated.
    </div>

    <div class="main-content">
        <!-- Bracket Section -->
        <section>
            <h2>Playoff Bracket</h2>
            <p class="click-hint">Click on a team in an unfinished game to simulate them winning</p>
            <div class="bracket-container">
                <div class="bracket">
                    <!-- NFC Side -->
                    <div class="conference" id="nfc-bracket">
                        <div class="round" id="nfc-wildcard">
                            <div class="round-label">Wild Card</div>
                        </div>
                        <div class="round" id="nfc-divisional">
                            <div class="round-label">Divisional</div>
                        </div>
                        <div class="round" id="nfc-championship">
                            <div class="round-label">NFC Champ</div>
                        </div>
                    </div>

                    <!-- Super Bowl -->
                    <div class="super-bowl">
                        <h3>Super Bowl LX</h3>
                        <div class="matchup" id="super-bowl-matchup"></div>
                    </div>

                    <!-- AFC Side -->
                    <div class="conference" id="afc-bracket">
                        <div class="round" id="afc-championship">
                            <div class="round-label">AFC Champ</div>
                        </div>
                        <div class="round" id="afc-divisional">
                            <div class="round-label">Divisional</div>
                        </div>
                        <div class="round" id="afc-wildcard">
                            <div class="round-label">Wild Card</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Super Bowl Scenarios -->
        <section id="scenarios-section" style="display: none;">
            <div class="section-header" onclick="toggleScenarios()">
                <h2 style="margin-bottom: 0; border-bottom: none;">Super Bowl Scenarios - Final Standings</h2>
                <button class="collapse-btn" id="scenarios-toggle">Hide ▲</button>
            </div>
            <div class="collapsible" id="scenarios-content" style="margin-top: 15px;">
                <p style="text-align: center; color: #888; font-size: 0.9rem; margin-bottom: 15px;">
                    * Indicates tie - winner determined by closest tiebreaker (total SB points)
                </p>
                <div class="scenarios-container">
                    <div class="scenario">
                        <h3 class="scenario-title">If SEA Wins Super Bowl</h3>
                        <table class="standings-table" id="scenario-sea-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Name</th>
                                    <th>Points</th>
                                    <th>Tiebreaker</th>
                                    <th>Payout</th>
                                </tr>
                            </thead>
                            <tbody id="scenario-sea-body"></tbody>
                        </table>
                    </div>
                    <div class="scenario">
                        <h3 class="scenario-title">If NE Wins Super Bowl</h3>
                        <table class="standings-table" id="scenario-ne-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Name</th>
                                    <th>Points</th>
                                    <th>Tiebreaker</th>
                                    <th>Payout</th>
                                </tr>
                            </thead>
                            <tbody id="scenario-ne-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- All Picks -->
        <section>
            <h2>All Picks</h2>
            <div class="legend">
                <div class="legend-item"><div class="legend-box correct"></div> Correct</div>
                <div class="legend-item"><div class="legend-box incorrect"></div> Incorrect</div>
                <div class="legend-item"><div class="legend-box pending"></div> Pending</div>
                <div class="legend-item"><div class="legend-box simulated"></div> Simulated</div>
            </div>
            <div class="picks-container">
                <table class="picks-table" id="picks-table">
                    <thead id="picks-header"></thead>
                    <tbody id="picks-body"></tbody>
                </table>
            </div>
        </section>

        <!-- Standings and Info -->
        <section>
            <div class="two-column">
                <div>
                    <div class="section-header" onclick="toggleStandings()">
                        <h2 style="margin-bottom: 0; border-bottom: none;">Standings</h2>
                        <button class="collapse-btn" id="standings-toggle">Hide ▲</button>
                    </div>
                    <div class="collapsible" id="standings-content" style="margin-top: 15px;">
                    <table class="standings-table" id="standings-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Points</th>
                                <th>Tiebreaker</th>
                                <th>Max Possible</th>
                            </tr>
                        </thead>
                        <tbody id="standings-body"></tbody>
                    </table>
                    </div>
                </div>
                <div class="sidebar">
                    <div class="info-box">
                        <h3>Scoring</h3>
                        <div class="scoring-grid">
                            <span>Wild Card</span><span>1 pt</span>
                            <span>Divisional</span><span>2 pts</span>
                            <span>Championship</span><span>3 pts</span>
                            <span>Super Bowl</span><span>4 pts</span>
                        </div>
                    </div>
                    <div class="info-box">
                        <h3>Payouts</h3>
                        <div class="payout-row"><span>1st Place</span><span>$130</span></div>
                        <div class="payout-row"><span>2nd Place</span><span>$70</span></div>
                        <div class="payout-row"><span>3rd Place</span><span>$40</span></div>
                        <div class="payout-row"><span>4th Place</span><span>$20</span></div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Team Data
        const teams = {
            'DEN': { name: 'Broncos', seed: 1, conf: 'AFC' },
            'NE': { name: 'Patriots', seed: 2, conf: 'AFC' },
            'JAX': { name: 'Jaguars', seed: 3, conf: 'AFC' },
            'PIT': { name: 'Steelers', seed: 4, conf: 'AFC' },
            'HOU': { name: 'Texans', seed: 5, conf: 'AFC' },
            'BUF': { name: 'Bills', seed: 6, conf: 'AFC' },
            'LAC': { name: 'Chargers', seed: 7, conf: 'AFC' },
            'SEA': { name: 'Seahawks', seed: 1, conf: 'NFC' },
            'CHI': { name: 'Bears', seed: 2, conf: 'NFC' },
            'PHI': { name: 'Eagles', seed: 3, conf: 'NFC' },
            'CAR': { name: 'Panthers', seed: 4, conf: 'NFC' },
            'LAR': { name: 'Rams', seed: 5, conf: 'NFC' },
            'SF': { name: '49ers', seed: 6, conf: 'NFC' },
            'GB': { name: 'Packers', seed: 7, conf: 'NFC' }
        };

        const espnToLocal = {
            'LAR': 'LAR', 'LA': 'LAR', 'CAR': 'CAR', 'CHI': 'CHI', 'GB': 'GB',
            'BUF': 'BUF', 'JAX': 'JAX', 'SF': 'SF', 'PHI': 'PHI', 'NE': 'NE',
            'LAC': 'LAC', 'HOU': 'HOU', 'PIT': 'PIT', 'DEN': 'DEN', 'SEA': 'SEA'
        };

        const wildcardMatchups = {
            afc: [
                { away: 'LAC', home: 'NE' },
                { away: 'BUF', home: 'JAX' },
                { away: 'HOU', home: 'PIT' }
            ],
            nfc: [
                { away: 'GB', home: 'CHI' },
                { away: 'SF', home: 'PHI' },
                { away: 'LAR', home: 'CAR' }
            ]
        };

        const participants = [
            'James', 'David', 'Chuck', 'Carol', 'Ryan', 'Marcus',
            'Sean', 'Corey', 'Paul', 'Michelle', 'Bryan', 'Christina', 'Amy'
        ];

        const picks = {
            'James':    { wcAfc: ['NE', 'JAX', 'HOU'], wcNfc: ['CHI', 'PHI', 'LAR'], divAfc: ['DEN', 'JAX'], divNfc: ['SEA', 'PHI'], champAfc: 'JAX', champNfc: 'SEA', sb: 'JAX', tiebreaker: 39 },
            'David':    { wcAfc: ['NE', 'BUF', 'HOU'], wcNfc: ['CHI', 'SF', 'LAR'], divAfc: ['BUF', 'NE'], divNfc: ['SEA', 'CHI'], champAfc: 'NE', champNfc: 'SEA', sb: 'SEA', tiebreaker: 55 },
            'Chuck':    { wcAfc: ['NE', 'JAX', 'HOU'], wcNfc: ['CHI', 'PHI', 'CAR'], divAfc: ['DEN', 'NE'], divNfc: ['SEA', 'CHI'], champAfc: 'DEN', champNfc: 'SEA', sb: 'DEN', tiebreaker: 41 },
            'Carol':    { wcAfc: ['NE', 'JAX', 'HOU'], wcNfc: ['CHI', 'SF', 'LAR'], divAfc: ['DEN', 'JAX'], divNfc: ['SEA', 'CHI'], champAfc: 'DEN', champNfc: 'SEA', sb: 'SEA', tiebreaker: 57 },
            'Ryan':     { wcAfc: ['LAC', 'BUF', 'HOU'], wcNfc: ['CHI', 'PHI', 'LAR'], divAfc: ['DEN', 'HOU'], divNfc: ['SEA', 'CHI'], champAfc: 'HOU', champNfc: 'SEA', sb: 'HOU', tiebreaker: 44 },
            'Marcus':   { wcAfc: ['NE', 'BUF', 'HOU'], wcNfc: ['GB', 'SF', 'LAR'], divAfc: ['BUF', 'NE'], divNfc: ['SEA', 'LAR'], champAfc: 'NE', champNfc: 'LAR', sb: 'LAR', tiebreaker: 47 },
            'Sean':     { wcAfc: ['LAC', 'JAX', 'HOU'], wcNfc: ['CHI', 'PHI', 'LAR'], divAfc: ['DEN', 'HOU'], divNfc: ['SEA', 'CHI'], champAfc: 'HOU', champNfc: 'CHI', sb: 'HOU', tiebreaker: 40 },
            'Corey':    { wcAfc: ['NE', 'BUF', 'HOU'], wcNfc: ['CHI', 'SF', 'LAR'], divAfc: ['DEN', 'NE'], divNfc: ['SEA', 'LAR'], champAfc: 'NE', champNfc: 'SEA', sb: 'SEA', tiebreaker: 57 },
            'Paul':     { wcAfc: ['NE', 'JAX', 'HOU'], wcNfc: ['CHI', 'PHI', 'LAR'], divAfc: ['DEN', 'NE'], divNfc: ['SEA', 'LAR'], champAfc: 'DEN', champNfc: 'LAR', sb: 'LAR', tiebreaker: 48 },
            'Michelle': { wcAfc: ['NE', 'JAX', 'HOU'], wcNfc: ['CHI', 'SF', 'CAR'], divAfc: ['DEN', 'JAX'], divNfc: ['SEA', 'CHI'], champAfc: 'DEN', champNfc: 'CHI', sb: 'CHI', tiebreaker: 41 },
            'Bryan':    { wcAfc: ['NE', 'JAX', 'HOU'], wcNfc: ['CHI', 'SF', 'LAR'], divAfc: ['DEN', 'NE'], divNfc: ['SEA', 'LAR'], champAfc: 'DEN', champNfc: 'SEA', sb: 'SEA', tiebreaker: 34 },
            'Christina':{ wcAfc: ['NE', 'BUF', 'HOU'], wcNfc: ['CHI', 'PHI', 'CAR'], divAfc: ['DEN', 'NE'], divNfc: ['SEA', 'CHI'], champAfc: 'NE', champNfc: 'SEA', sb: 'NE', tiebreaker: 51 },
            'Amy':      { wcAfc: ['NE', 'BUF', 'HOU'], wcNfc: ['GB', 'PHI', 'LAR'], divAfc: ['DEN', 'NE'], divNfc: ['SEA', 'LAR'], champAfc: 'DEN', champNfc: 'SEA', sb: 'DEN', tiebreaker: 36 }
        };

        // Load actual results from localStorage or initialize with completed playoff results
        let actualResults = JSON.parse(localStorage.getItem('nflMadnessResults')) || {
            wcAfc: ['NE', 'BUF', 'HOU'],  // Wild Card: NE beat LAC 16-3, BUF beat JAX 27-24, HOU beat PIT 30-6
            wcNfc: ['CHI', 'SF', 'LAR'],   // Wild Card: CHI beat GB 31-27, SF beat PHI 23-19, LAR beat CAR 34-31
            divAfc: ['DEN', 'NE'],         // Divisional: DEN beat BUF 33-30, NE beat HOU 28-16
            divNfc: ['SEA', 'LAR'],        // Divisional: SEA beat SF 41-6, LAR beat CHI 20-17
            champAfc: 'NE',                // AFC Championship: NE beat DEN 10-7
            champNfc: 'SEA',               // NFC Championship: SEA beat LAR 31-27
            sbWinner: null,                // Super Bowl: SEA vs NE (not yet played)
            sbTotalPoints: null,
            games: {
                // Wild Card
                'LAC@NE': { homeTeam: 'NE', awayTeam: 'LAC', homeScore: 16, awayScore: 3, completed: true, winner: 'NE' },
                'BUF@JAX': { homeTeam: 'JAX', awayTeam: 'BUF', homeScore: 24, awayScore: 27, completed: true, winner: 'BUF' },
                'HOU@PIT': { homeTeam: 'PIT', awayTeam: 'HOU', homeScore: 6, awayScore: 30, completed: true, winner: 'HOU' },
                'GB@CHI': { homeTeam: 'CHI', awayTeam: 'GB', homeScore: 31, awayScore: 27, completed: true, winner: 'CHI' },
                'SF@PHI': { homeTeam: 'PHI', awayTeam: 'SF', homeScore: 19, awayScore: 23, completed: true, winner: 'SF' },
                'LAR@CAR': { homeTeam: 'CAR', awayTeam: 'LAR', homeScore: 31, awayScore: 34, completed: true, winner: 'LAR' },
                // Divisional
                'BUF@DEN': { homeTeam: 'DEN', awayTeam: 'BUF', homeScore: 33, awayScore: 30, completed: true, winner: 'DEN' },
                'SF@SEA': { homeTeam: 'SEA', awayTeam: 'SF', homeScore: 41, awayScore: 6, completed: true, winner: 'SEA' },
                'HOU@NE': { homeTeam: 'NE', awayTeam: 'HOU', homeScore: 28, awayScore: 16, completed: true, winner: 'NE' },
                'LAR@CHI': { homeTeam: 'CHI', awayTeam: 'LAR', homeScore: 17, awayScore: 20, completed: true, winner: 'LAR' },
                // Championship
                'NE@DEN': { homeTeam: 'DEN', awayTeam: 'NE', homeScore: 7, awayScore: 10, completed: true, winner: 'NE' },
                'LAR@SEA': { homeTeam: 'SEA', awayTeam: 'LAR', homeScore: 31, awayScore: 27, completed: true, winner: 'SEA' }
            }
        };

        // Save results to localStorage
        function saveResults() {
            localStorage.setItem('nflMadnessResults', JSON.stringify(actualResults));
        }

        // Simulated results (user clicks)
        let simResults = {
            wcAfc: [null, null, null],
            wcNfc: [null, null, null],
            divAfc: [null, null],
            divNfc: [null, null],
            champAfc: null,
            champNfc: null,
            sbWinner: null
        };

        // Get effective results (actual + simulated)
        function getEffectiveResults() {
            return {
                wcAfc: actualResults.wcAfc.map((r, i) => r || simResults.wcAfc[i]),
                wcNfc: actualResults.wcNfc.map((r, i) => r || simResults.wcNfc[i]),
                divAfc: actualResults.divAfc.map((r, i) => r || simResults.divAfc[i]),
                divNfc: actualResults.divNfc.map((r, i) => r || simResults.divNfc[i]),
                champAfc: actualResults.champAfc || simResults.champAfc,
                champNfc: actualResults.champNfc || simResults.champNfc,
                sbWinner: actualResults.sbWinner || simResults.sbWinner,
                sbTotalPoints: actualResults.sbTotalPoints,
                games: actualResults.games
            };
        }

        function countSimulations() {
            let count = 0;
            simResults.wcAfc.forEach(r => r && count++);
            simResults.wcNfc.forEach(r => r && count++);
            simResults.divAfc.forEach(r => r && count++);
            simResults.divNfc.forEach(r => r && count++);
            if (simResults.champAfc) count++;
            if (simResults.champNfc) count++;
            if (simResults.sbWinner) count++;
            return count;
        }

        function updateSimulationUI() {
            const count = countSimulations();
            const banner = document.getElementById('sim-banner');
            const clearBtn = document.getElementById('clear-sim-btn');
            const countSpan = document.getElementById('sim-count');

            if (count > 0) {
                banner.classList.add('active');
                clearBtn.style.display = 'inline-block';
                countSpan.textContent = count;
            } else {
                banner.classList.remove('active');
                clearBtn.style.display = 'none';
            }
        }

        function clearSimulation() {
            simResults = {
                wcAfc: [null, null, null],
                wcNfc: [null, null, null],
                divAfc: [null, null],
                divNfc: [null, null],
                champAfc: null,
                champNfc: null,
                sbWinner: null
            };
            updateSimulationUI();
            renderAll();
        }

        function simulateWinner(round, conf, idx, winner) {
            // Don't simulate if actual result exists
            if (round === 'wc') {
                const key = conf === 'AFC' ? 'wcAfc' : 'wcNfc';
                if (actualResults[key][idx]) return;
                simResults[key][idx] = simResults[key][idx] === winner ? null : winner;
            } else if (round === 'div') {
                const key = conf === 'AFC' ? 'divAfc' : 'divNfc';
                if (actualResults[key][idx]) return;
                simResults[key][idx] = simResults[key][idx] === winner ? null : winner;
            } else if (round === 'champ') {
                const key = conf === 'AFC' ? 'champAfc' : 'champNfc';
                if (actualResults[key]) return;
                simResults[key] = simResults[key] === winner ? null : winner;
            } else if (round === 'sb') {
                if (actualResults.sbWinner) return;
                simResults.sbWinner = simResults.sbWinner === winner ? null : winner;
            }

            // Clear downstream simulations when changing upstream
            clearDownstream(round, conf, idx);

            updateSimulationUI();
            renderAll();
        }

        function clearDownstream(round, conf, idx) {
            if (round === 'wc') {
                // Clear divisional and beyond for this conference
                const divKey = conf === 'AFC' ? 'divAfc' : 'divNfc';
                const champKey = conf === 'AFC' ? 'champAfc' : 'champNfc';
                simResults[divKey] = [null, null];
                simResults[champKey] = null;
                simResults.sbWinner = null;
            } else if (round === 'div') {
                const champKey = conf === 'AFC' ? 'champAfc' : 'champNfc';
                simResults[champKey] = null;
                simResults.sbWinner = null;
            } else if (round === 'champ') {
                simResults.sbWinner = null;
            }
        }

        // Fetch ESPN Data - get all playoff games for the 2026 season
        async function fetchESPNData() {
            try {
                document.getElementById('last-updated').textContent = 'Fetching scores...';
                // Fetch all playoff games from Jan 10 - Feb 10 to cover Wild Card through Super Bowl
                const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard?dates=20260110-20260210&seasontype=3');
                const data = await response.json();
                processESPNData(data);
                saveResults();  // Persist results to localStorage
                document.getElementById('last-updated').textContent = `Last updated: ${new Date().toLocaleString()}`;
                renderAll();
            } catch (error) {
                console.error('Error fetching ESPN data:', error);
                document.getElementById('last-updated').textContent = 'Error loading scores. Using cached data.';
                renderAll();
            }
        }

        function processESPNData(data) {
            if (!data.events) return;

            data.events.forEach(event => {
                const competition = event.competitions[0];
                const status = competition.status.type.completed;
                const seasonType = event.season.type;

                if (seasonType !== 3) return;

                const homeTeam = competition.competitors.find(c => c.homeAway === 'home');
                const awayTeam = competition.competitors.find(c => c.homeAway === 'away');

                const homeAbbr = espnToLocal[homeTeam.team.abbreviation] || homeTeam.team.abbreviation;
                const awayAbbr = espnToLocal[awayTeam.team.abbreviation] || awayTeam.team.abbreviation;
                const homeScore = parseInt(homeTeam.score) || 0;
                const awayScore = parseInt(awayTeam.score) || 0;

                const gameKey = `${awayAbbr}@${homeAbbr}`;
                actualResults.games[gameKey] = {
                    homeTeam: homeAbbr, awayTeam: awayAbbr,
                    homeScore, awayScore, completed: status,
                    winner: status ? (homeScore > awayScore ? homeAbbr : awayAbbr) : null
                };

                if (!status) return;

                const winner = homeScore > awayScore ? homeAbbr : awayAbbr;
                const notes = competition.notes;
                const headline = notes && notes[0] ? notes[0].headline : '';

                // Championship games (check these first!)
                if (headline.includes('AFC Championship')) {
                    actualResults.champAfc = winner;
                } else if (headline.includes('NFC Championship')) {
                    actualResults.champNfc = winner;
                }
                // Wild Card
                else if ((awayAbbr === 'LAC' && homeAbbr === 'NE') || (awayAbbr === 'NE' && homeAbbr === 'LAC')) {
                    actualResults.wcAfc[0] = winner;
                } else if ((awayAbbr === 'BUF' && homeAbbr === 'JAX') || (awayAbbr === 'JAX' && homeAbbr === 'BUF')) {
                    actualResults.wcAfc[1] = winner;
                } else if ((awayAbbr === 'HOU' && homeAbbr === 'PIT') || (awayAbbr === 'PIT' && homeAbbr === 'HOU')) {
                    actualResults.wcAfc[2] = winner;
                } else if ((awayAbbr === 'GB' && homeAbbr === 'CHI') || (awayAbbr === 'CHI' && homeAbbr === 'GB')) {
                    actualResults.wcNfc[0] = winner;
                } else if ((awayAbbr === 'SF' && homeAbbr === 'PHI') || (awayAbbr === 'PHI' && homeAbbr === 'SF')) {
                    actualResults.wcNfc[1] = winner;
                } else if ((awayAbbr === 'LAR' && homeAbbr === 'CAR') || (awayAbbr === 'CAR' && homeAbbr === 'LAR')) {
                    actualResults.wcNfc[2] = winner;
                }
                // Divisional
                else if (homeAbbr === 'DEN' || awayAbbr === 'DEN') {
                    actualResults.divAfc[0] = winner;
                } else if (homeAbbr === 'SEA' || awayAbbr === 'SEA') {
                    actualResults.divNfc[0] = winner;
                } else if (teams[homeAbbr]?.conf === 'AFC' && teams[awayAbbr]?.conf === 'AFC') {
                    if (actualResults.divAfc[1] === null) actualResults.divAfc[1] = winner;
                } else if (teams[homeAbbr]?.conf === 'NFC' && teams[awayAbbr]?.conf === 'NFC') {
                    if (actualResults.divNfc[1] === null) actualResults.divNfc[1] = winner;
                }

                if (headline.includes('Super Bowl')) {
                    actualResults.sbWinner = winner;
                    actualResults.sbTotalPoints = homeScore + awayScore;
                }
            });
        }

        // Calculate scores
        function calculateScores(results, includeSimulated = false) {
            const scores = {};

            participants.forEach(name => {
                const p = picks[name];
                let points = 0;
                let simPoints = 0;
                let maxPossible = 0;

                // Wild Card
                for (let i = 0; i < 3; i++) {
                    // AFC
                    if (actualResults.wcAfc[i] !== null) {
                        if (p.wcAfc[i] === actualResults.wcAfc[i]) points += 1;
                    } else if (results.wcAfc[i] !== null) {
                        if (p.wcAfc[i] === results.wcAfc[i]) simPoints += 1;
                    } else {
                        maxPossible += 1;
                    }
                    // NFC
                    if (actualResults.wcNfc[i] !== null) {
                        if (p.wcNfc[i] === actualResults.wcNfc[i]) points += 1;
                    } else if (results.wcNfc[i] !== null) {
                        if (p.wcNfc[i] === results.wcNfc[i]) simPoints += 1;
                    } else {
                        maxPossible += 1;
                    }
                }

                // Divisional
                for (let i = 0; i < 2; i++) {
                    if (actualResults.divAfc[i] !== null) {
                        if (p.divAfc[i] === actualResults.divAfc[i]) points += 2;
                    } else if (results.divAfc[i] !== null) {
                        if (p.divAfc[i] === results.divAfc[i]) simPoints += 2;
                    } else if (canStillWin(p.divAfc[i], 'divAfc', i, results)) {
                        maxPossible += 2;
                    }

                    if (actualResults.divNfc[i] !== null) {
                        if (p.divNfc[i] === actualResults.divNfc[i]) points += 2;
                    } else if (results.divNfc[i] !== null) {
                        if (p.divNfc[i] === results.divNfc[i]) simPoints += 2;
                    } else if (canStillWin(p.divNfc[i], 'divNfc', i, results)) {
                        maxPossible += 2;
                    }
                }

                // Championship
                if (actualResults.champAfc !== null) {
                    if (p.champAfc === actualResults.champAfc) points += 3;
                } else if (results.champAfc !== null) {
                    if (p.champAfc === results.champAfc) simPoints += 3;
                } else if (canStillWinChamp(p.champAfc, 'AFC', results)) {
                    maxPossible += 3;
                }

                if (actualResults.champNfc !== null) {
                    if (p.champNfc === actualResults.champNfc) points += 3;
                } else if (results.champNfc !== null) {
                    if (p.champNfc === results.champNfc) simPoints += 3;
                } else if (canStillWinChamp(p.champNfc, 'NFC', results)) {
                    maxPossible += 3;
                }

                // Super Bowl
                if (actualResults.sbWinner !== null) {
                    if (p.sb === actualResults.sbWinner) points += 4;
                } else if (results.sbWinner !== null) {
                    if (p.sb === results.sbWinner) simPoints += 4;
                } else if (canStillWinSB(p.sb, results)) {
                    maxPossible += 4;
                }

                scores[name] = {
                    points,
                    simPoints,
                    totalPoints: points + simPoints,
                    maxPossible: points + simPoints + maxPossible,
                    tiebreaker: p.tiebreaker
                };
            });

            return scores;
        }

        function canStillWin(team, round, idx, results) {
            const byeTeam = round === 'divAfc' ? 'DEN' : 'SEA';
            const wcKey = round === 'divAfc' ? 'wcAfc' : 'wcNfc';

            if (team === byeTeam) return true;

            for (let i = 0; i < 3; i++) {
                if (results[wcKey][i] === team) return true;
                if (results[wcKey][i] === null) {
                    const matchups = round === 'divAfc' ? wildcardMatchups.afc : wildcardMatchups.nfc;
                    if (matchups[i].away === team || matchups[i].home === team) return true;
                }
            }
            return false;
        }

        function canStillWinChamp(team, conf, results) {
            const divKey = conf === 'AFC' ? 'divAfc' : 'divNfc';
            if (results[divKey][0] === team || results[divKey][1] === team) return true;
            if (results[divKey][0] === null || results[divKey][1] === null) {
                return canStillWin(team, divKey, 0, results) || canStillWin(team, divKey, 1, results);
            }
            return false;
        }

        function canStillWinSB(team, results) {
            const conf = teams[team]?.conf;
            if (!conf) return false;
            if (results.champAfc === team || results.champNfc === team) return true;
            if (conf === 'AFC' && results.champAfc === null) return canStillWinChamp(team, 'AFC', results);
            if (conf === 'NFC' && results.champNfc === null) return canStillWinChamp(team, 'NFC', results);
            return false;
        }

        function renderAll() {
            const results = getEffectiveResults();
            renderBracket(results);
            renderStandings(results);
            renderPicks(results);
            renderScenarios();
        }

        function renderStandings(results) {
            const scores = calculateScores(results, true);
            const baseScores = calculateScores(actualResults, false);

            const sorted = participants.map(name => ({
                name,
                ...scores[name],
                basePoints: baseScores[name].points
            })).sort((a, b) => {
                if (b.totalPoints !== a.totalPoints) return b.totalPoints - a.totalPoints;
                if (results.sbTotalPoints !== null) {
                    return Math.abs(a.tiebreaker - results.sbTotalPoints) - Math.abs(b.tiebreaker - results.sbTotalPoints);
                }
                return 0;
            });

            // Calculate base rankings for comparison
            const baseSorted = participants.map(name => ({
                name, points: baseScores[name].points
            })).sort((a, b) => b.points - a.points);
            const baseRanks = {};
            baseSorted.forEach((p, i) => baseRanks[p.name] = i + 1);

            const tbody = document.getElementById('standings-body');
            tbody.innerHTML = sorted.map((p, i) => {
                const rank = i + 1;
                const baseRank = baseRanks[p.name];
                const rankChange = baseRank - rank;
                let changeHtml = '';
                if (countSimulations() > 0 && rankChange !== 0) {
                    changeHtml = `<span class="change ${rankChange > 0 ? 'up' : 'down'}">${rankChange > 0 ? '▲' : '▼'}${Math.abs(rankChange)}</span>`;
                }

                const simHtml = p.simPoints > 0 ? `<span class="sim-points">(+${p.simPoints})</span>` : '';

                return `
                    <tr>
                        <td class="rank rank-${rank}">${rank}${changeHtml}</td>
                        <td>${p.name}</td>
                        <td class="points">${p.points}${simHtml}</td>
                        <td class="tiebreaker">${p.tiebreaker} pts</td>
                        <td>${p.maxPossible}</td>
                    </tr>
                `;
            }).join('');
        }

        function renderBracket(results) {
            // NFC Wild Card
            const nfcWc = document.getElementById('nfc-wildcard');
            nfcWc.innerHTML = '<div class="round-label">Wild Card</div>';
            wildcardMatchups.nfc.forEach((game, i) => {
                const gameKey = `${game.away}@${game.home}`;
                const gameData = results.games[gameKey] || {};
                const actualWinner = actualResults.wcNfc[i];
                const simWinner = simResults.wcNfc[i];
                nfcWc.innerHTML += createMatchup(game.away, game.home, actualWinner, simWinner, gameData, 'wc', 'NFC', i);
            });

            // AFC Wild Card
            const afcWc = document.getElementById('afc-wildcard');
            afcWc.innerHTML = '<div class="round-label">Wild Card</div>';
            wildcardMatchups.afc.forEach((game, i) => {
                const gameKey = `${game.away}@${game.home}`;
                const gameData = results.games[gameKey] || {};
                const actualWinner = actualResults.wcAfc[i];
                const simWinner = simResults.wcAfc[i];
                afcWc.innerHTML += createMatchup(game.away, game.home, actualWinner, simWinner, gameData, 'wc', 'AFC', i);
            });

            // Divisional
            renderDivisional('nfc', results);
            renderDivisional('afc', results);

            // Championship
            renderChampionship('nfc', results);
            renderChampionship('afc', results);

            // Super Bowl
            renderSuperBowl(results);
        }

        function renderDivisional(conf, results) {
            const divEl = document.getElementById(`${conf}-divisional`);
            divEl.innerHTML = '<div class="round-label">Divisional</div>';

            const wcKey = conf === 'afc' ? 'wcAfc' : 'wcNfc';
            const divKey = conf === 'afc' ? 'divAfc' : 'divNfc';
            const byeTeam = conf === 'afc' ? 'DEN' : 'SEA';
            const confUpper = conf.toUpperCase();

            const wcWinners = results[wcKey].filter(w => w !== null);

            if (wcWinners.length === 3) {
                const sorted = [...wcWinners].sort((a, b) => teams[b].seed - teams[a].seed);
                // Lowest seed vs bye team
                divEl.innerHTML += createMatchup(sorted[0], byeTeam, actualResults[divKey][0], simResults[divKey][0], {}, 'div', confUpper, 0);
                // Middle vs highest seed winner
                divEl.innerHTML += createMatchup(sorted[2], sorted[1], actualResults[divKey][1], simResults[divKey][1], {}, 'div', confUpper, 1);
            } else {
                divEl.innerHTML += createMatchup('TBD', byeTeam, null, null, {}, 'div', confUpper, 0);
                divEl.innerHTML += createMatchup('TBD', 'TBD', null, null, {}, 'div', confUpper, 1);
            }
        }

        function renderChampionship(conf, results) {
            const champEl = document.getElementById(`${conf}-championship`);
            champEl.innerHTML = `<div class="round-label">${conf.toUpperCase()} Champ</div>`;

            const divKey = conf === 'afc' ? 'divAfc' : 'divNfc';
            const champKey = conf === 'afc' ? 'champAfc' : 'champNfc';
            const confUpper = conf.toUpperCase();

            const divWinners = results[divKey].filter(w => w !== null);

            if (divWinners.length === 2) {
                const sorted = [...divWinners].sort((a, b) => teams[b].seed - teams[a].seed);
                champEl.innerHTML += createMatchup(sorted[0], sorted[1], actualResults[champKey], simResults[champKey], {}, 'champ', confUpper, 0);
            } else {
                champEl.innerHTML += createMatchup('TBD', 'TBD', null, null, {}, 'champ', confUpper, 0);
            }
        }

        function renderSuperBowl(results) {
            const sbEl = document.getElementById('super-bowl-matchup');
            const nfcRep = results.champNfc || 'TBD';
            const afcRep = results.champAfc || 'TBD';

            const actualWinner = actualResults.sbWinner;
            const simWinner = simResults.sbWinner;

            const canClick = !actualWinner && nfcRep !== 'TBD' && afcRep !== 'TBD';

            sbEl.innerHTML = `
                <div class="team ${actualWinner === nfcRep ? 'winner' : simWinner === nfcRep ? 'simulated' : actualWinner ? 'loser' : ''} ${canClick ? 'clickable' : ''}"
                     ${canClick ? `onclick="simulateWinner('sb', 'NFC', 0, '${nfcRep}')"` : ''}>
                    <span>NFC</span> <span>${nfcRep}</span>
                </div>
                <div class="team ${actualWinner === afcRep ? 'winner' : simWinner === afcRep ? 'simulated' : actualWinner ? 'loser' : ''} ${canClick ? 'clickable' : ''}"
                     ${canClick ? `onclick="simulateWinner('sb', 'AFC', 0, '${afcRep}')"` : ''}>
                    <span>AFC</span> <span>${afcRep}</span>
                </div>
            `;
        }

        function createMatchup(away, home, actualWinner, simWinner, gameData, round, conf, idx) {
            const awayTeam = teams[away] || { name: away, seed: '?' };
            const homeTeam = teams[home] || { name: home, seed: '?' };
            const awayScore = gameData.awayScore !== undefined ? gameData.awayScore : '';
            const homeScore = gameData.homeScore !== undefined ? gameData.homeScore : '';

            const winner = actualWinner || simWinner;
            const canClick = !actualWinner && away !== 'TBD' && home !== 'TBD';

            const awayClass = actualWinner === away ? 'winner' : simWinner === away ? 'simulated' : winner ? 'loser' : '';
            const homeClass = actualWinner === home ? 'winner' : simWinner === home ? 'simulated' : winner ? 'loser' : '';

            return `
                <div class="matchup">
                    <div class="team ${awayClass} ${canClick ? 'clickable' : ''}"
                         ${canClick ? `onclick="simulateWinner('${round}', '${conf}', ${idx}, '${away}')"` : ''}>
                        <span class="seed">${awayTeam.seed}</span>
                        <span>${away}</span>
                        ${awayScore !== '' ? `<span class="score">${awayScore}</span>` : ''}
                    </div>
                    <div class="team ${homeClass} ${canClick ? 'clickable' : ''}"
                         ${canClick ? `onclick="simulateWinner('${round}', '${conf}', ${idx}, '${home}')"` : ''}>
                        <span class="seed">${homeTeam.seed}</span>
                        <span>${home}</span>
                        ${homeScore !== '' ? `<span class="score">${homeScore}</span>` : ''}
                    </div>
                </div>
            `;
        }

        function renderPicks(results) {
            const header = document.getElementById('picks-header');
            const body = document.getElementById('picks-body');

            header.innerHTML = `
                <tr>
                    <th>Round</th>
                    <th>Game</th>
                    <th>Result</th>
                    ${participants.map(p => `<th>${p}</th>`).join('')}
                </tr>
            `;

            const games = [
                { round: 'Wild Card (1pt)', name: 'LAC @ NE', actualKey: 'wcAfc', simKey: 'wcAfc', idx: 0, pickKey: 'wcAfc' },
                { round: '', name: 'BUF @ JAX', actualKey: 'wcAfc', simKey: 'wcAfc', idx: 1, pickKey: 'wcAfc' },
                { round: '', name: 'HOU @ PIT', actualKey: 'wcAfc', simKey: 'wcAfc', idx: 2, pickKey: 'wcAfc' },
                { round: '', name: 'GB @ CHI', actualKey: 'wcNfc', simKey: 'wcNfc', idx: 0, pickKey: 'wcNfc' },
                { round: '', name: 'SF @ PHI', actualKey: 'wcNfc', simKey: 'wcNfc', idx: 1, pickKey: 'wcNfc' },
                { round: '', name: 'LAR @ CAR', actualKey: 'wcNfc', simKey: 'wcNfc', idx: 2, pickKey: 'wcNfc' },
                { round: 'Divisional (2pts)', name: 'AFC vs DEN', actualKey: 'divAfc', simKey: 'divAfc', idx: 0, pickKey: 'divAfc' },
                { round: '', name: 'AFC Other', actualKey: 'divAfc', simKey: 'divAfc', idx: 1, pickKey: 'divAfc' },
                { round: '', name: 'NFC vs SEA', actualKey: 'divNfc', simKey: 'divNfc', idx: 0, pickKey: 'divNfc' },
                { round: '', name: 'NFC Other', actualKey: 'divNfc', simKey: 'divNfc', idx: 1, pickKey: 'divNfc' },
                { round: 'Championship (3pts)', name: 'AFC Champ', actualKey: 'champAfc', simKey: 'champAfc', idx: null, pickKey: 'champAfc' },
                { round: '', name: 'NFC Champ', actualKey: 'champNfc', simKey: 'champNfc', idx: null, pickKey: 'champNfc' },
                { round: 'Super Bowl (4pts)', name: 'Super Bowl', actualKey: 'sbWinner', simKey: 'sbWinner', idx: null, pickKey: 'sb' },
                { round: 'Tiebreaker', name: 'Total Points', actualKey: 'sbTotalPoints', simKey: null, idx: null, pickKey: 'tiebreaker' }
            ];

            const gameRows = games.map(game => {
                const actual = game.idx !== null ? actualResults[game.actualKey]?.[game.idx] : actualResults[game.actualKey];
                const sim = game.simKey && (game.idx !== null ? simResults[game.simKey]?.[game.idx] : simResults[game.simKey]);
                const effective = actual || sim;

                let resultDisplay = '-';
                if (actual) resultDisplay = actual;
                else if (sim) resultDisplay = `<span style="color:#FF9800">${sim}*</span>`;

                return `
                    <tr>
                        <td class="game-col ${game.round ? 'round-header' : ''}">${game.round}</td>
                        <td class="game-col">${game.name}</td>
                        <td class="actual-result">${resultDisplay}</td>
                        ${participants.map(name => {
                            const pick = game.idx !== null ? picks[name][game.pickKey]?.[game.idx] : picks[name][game.pickKey];
                            let className = 'pending';

                            if (actual !== null && actual !== undefined) {
                                if (game.pickKey === 'tiebreaker') {
                                    className = '';
                                } else {
                                    className = pick === actual ? 'correct' : 'incorrect';
                                }
                            } else if (sim) {
                                className = pick === sim ? 'simulated-correct' : 'simulated-incorrect';
                            }

                            return `<td class="${className}">${pick}</td>`;
                        }).join('')}
                    </tr>
                `;
            }).join('');

            // Calculate scores for the totals row
            const scores = calculateScores(results, true);

            const totalsRow = `
                <tr style="background: rgba(255,255,255,0.1); font-weight: bold;">
                    <td class="game-col" style="background: rgba(76, 175, 80, 0.3);">TOTAL</td>
                    <td class="game-col" style="background: rgba(76, 175, 80, 0.3);">Score</td>
                    <td class="actual-result" style="background: rgba(76, 175, 80, 0.3);">-</td>
                    ${participants.map(name => {
                        const s = scores[name];
                        const simHtml = s.simPoints > 0 ? `<span style="color:#FF9800; font-size:0.75rem;"> (+${s.simPoints})</span>` : '';
                        return `<td style="background: rgba(76, 175, 80, 0.2); font-size: 1rem;">${s.points}${simHtml}</td>`;
                    }).join('')}
                </tr>
            `;

            body.innerHTML = gameRows + totalsRow;
        }

        // Render Super Bowl scenarios
        function renderScenarios() {
            const results = getEffectiveResults();

            // Only show scenarios if we're at the Super Bowl (both championship games decided, SB not decided)
            if (!results.champAfc || !results.champNfc || results.sbWinner) {
                document.getElementById('scenarios-section').style.display = 'none';
                return;
            }

            document.getElementById('scenarios-section').style.display = 'block';

            const payouts = [130, 70, 40, 20];

            // Scenario 1: SEA wins
            const seaResults = { ...results, sbWinner: 'SEA', sbTotalPoints: 50 }; // Use placeholder for tiebreaker
            const seaScores = calculateScores(seaResults, false);
            renderScenarioTable('scenario-sea-body', seaScores, payouts);

            // Scenario 2: NE wins
            const neResults = { ...results, sbWinner: 'NE', sbTotalPoints: 50 }; // Use placeholder for tiebreaker
            const neScores = calculateScores(neResults, false);
            renderScenarioTable('scenario-ne-body', neScores, payouts);
        }

        function renderScenarioTable(bodyId, scores, payouts) {
            const sorted = participants.map(name => ({
                name,
                ...scores[name]
            })).sort((a, b) => {
                if (b.totalPoints !== a.totalPoints) return b.totalPoints - a.totalPoints;
                // If tied, show tiebreaker would matter
                return 0;
            });

            const tbody = document.getElementById(bodyId);
            tbody.innerHTML = sorted.map((p, i) => {
                const rank = i + 1;
                const payout = rank <= 4 ? `$${payouts[rank - 1]}` : '-';

                // Check if there are ties at this position
                let tiedWith = [];
                sorted.forEach((other, j) => {
                    if (other.totalPoints === p.totalPoints && j !== i) {
                        tiedWith.push(other.name);
                    }
                });
                const hasTie = tiedWith.length > 0;

                return `
                    <tr>
                        <td class="rank rank-${rank}">${rank}${hasTie ? '*' : ''}</td>
                        <td>${p.name}</td>
                        <td class="points">${p.totalPoints}</td>
                        <td class="tiebreaker">${p.tiebreaker} pts</td>
                        <td class="payout-value">${payout}</td>
                    </tr>
                `;
            }).join('');
        }

        // Toggle scenarios visibility
        function toggleScenarios() {
            const content = document.getElementById('scenarios-content');
            const btn = document.getElementById('scenarios-toggle');

            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                btn.textContent = 'Hide ▲';
            } else {
                content.classList.add('collapsed');
                btn.textContent = 'Show ▼';
            }
        }

        // Toggle standings visibility
        function toggleStandings() {
            const content = document.getElementById('standings-content');
            const btn = document.getElementById('standings-toggle');

            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                btn.textContent = 'Hide ▲';
            } else {
                content.classList.add('collapsed');
                btn.textContent = 'Show ▼';
            }
        }

        // Initialize
        fetchESPNData();
        setInterval(fetchESPNData, 5 * 60 * 1000);
    </script>
</body>
</html>
